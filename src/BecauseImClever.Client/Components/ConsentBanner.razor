@using BecauseImClever.Application.Interfaces
@inject IConsentService ConsentService

@if (showBanner)
{
    <div class="consent-overlay">
        <div class="consent-modal">
            <div class="consent-icon">ðŸ”’</div>
            <h3>Privacy & Extension Detection</h3>
            <p>
                We'd like to detect browser extensions to help protect you from potentially harmful ones. 
                This information is collected anonymously and helps us provide security warnings.
            </p>
            <p class="privacy-note">
                Your privacy matters. No personal data is storedâ€”only hashed identifiers for analytics.
                <a href="/privacy">Read our Privacy Policy</a>
            </p>
            <div class="consent-actions">
                <button class="decline-btn" @onclick="DeclineAsync">Decline</button>
                <button class="accept-btn" @onclick="AcceptAsync">Accept</button>
            </div>
        </div>
    </div>
}

@code {
    private bool showBanner;

    protected override async Task OnInitializedAsync()
    {
        var hasConsented = await this.ConsentService.HasConsentBeenGivenAsync();
        this.showBanner = !hasConsented;
    }

    private async Task AcceptAsync()
    {
        await this.ConsentService.SaveConsentAsync(true);
        this.showBanner = false;
    }

    private async Task DeclineAsync()
    {
        await this.ConsentService.SaveConsentAsync(false);
        this.showBanner = false;
    }
}
