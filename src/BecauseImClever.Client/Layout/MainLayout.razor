@inherits LayoutComponentBase
@using BecauseImClever.Application.Interfaces
@using BecauseImClever.Domain.Entities
@using BecauseImClever.Client.Components
@inject IThemeService ThemeService

<div class="layout-container">
    <!-- Header -->
    <header>
        <a href="" class="logo">&lt;BecauseImClever /&gt;</a>
        <nav>
            <ul>
                <li><a href="">Home</a></li>
                <li><a href="posts">Blog</a></li>
                <li><a href="projects">Projects</a></li>
                <li><a href="clock">Clock</a></li>
                <li><a href="about">About</a></li>
            </ul>
        </nav>
        <select class="theme-switch" @onchange="OnThemeChanged" value="@currentTheme?.Key">
            @foreach (var theme in availableThemes)
            {
                <option value="@theme.Key">@theme.DisplayName</option>
            }
        </select>
    </header>

    @Body

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 BecauseImClever. Built with .NET 10 & Blazor.</p>
    </footer>

    <!-- Extension Warning Banner -->
    <ExtensionWarningBanner />
</div>

@code {
    private Theme? currentTheme;
    private IReadOnlyList<Theme> availableThemes = Array.Empty<Theme>();

    protected override async Task OnInitializedAsync()
    {
        availableThemes = ThemeService.GetAvailableThemes();
        currentTheme = await ThemeService.GetCurrentThemeAsync();
        await ThemeService.SetThemeAsync(currentTheme);
    }

    private async Task OnThemeChanged(ChangeEventArgs e)
    {
        var selectedKey = e.Value?.ToString();
        currentTheme = Theme.FromKey(selectedKey);
        await ThemeService.SetThemeAsync(currentTheme);
    }
}
